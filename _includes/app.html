<script>
// app here
var OI = {
    init:
        function() {
            OI.progressHandler.charge();
        }
};
OI.progressHandler = {
    charge_offset: 3,
    updateBar:
        function(barid, value) {
            jQuery("#"+barid).attr('aria-valuenow', value);
            jQuery("#"+barid+" .number-progress").html(value);
            jQuery("#"+barid).css("width", value + "%");
            OI.progressHandler.specialValuesColorChange(barid, value);
        },
    specialValuesColorChange:
        (function() {
            var colorcount = 6;
            var spacing = 100 / colorcount;
            /* Colors: dark gray/gray/red/orange/blue/green */
            var colors = ["default", "primary", "danger", "warning", "info", "success"];
            var colorpercents = [];
            var last = 0;
            /* Add color -> percent mappings */
            for (var i = 0; i < colorcount; i++) {
                colorpercents[i] = last;
                last += spacing;
            }
            if (colorpercents[colorcount - 1] !== 100) {
                /* make sure we hit the last one on 100 */
                colorpercents[colorcount - 1] = 100;
            }
            /* Build percent -> color mappings, using the color mappings */
            var percentcolors = [];
            var nextIndex = 0;
            /* note: 101 values, 0 -> 100  */
            for (var i = 0; i <= 100; i++) {
                var color = colorpercents[nextIndex];
                if (i <= color) {
                    /* Color range valid */
                    percentcolors[i] = colors[nextIndex];
                } else {
                    /* invalid, next one */
                    nextIndex++;
                    i--;
                }
            }
            return function (barid, value) {
                console.log(percentcolors[value]);
                jQuery("#" + barid).attr("class", "progress-bar progress-bar-" + percentcolors[value]);
            }
        })(),
    getValue:
        function (barid) {
            return parseInt(jQuery("#"+barid).attr('aria-valuenow'));
        },
    charge:
        function() {
            if(OI.progressHandler.getValue("prog-bar") + OI.progressHandler.charge_offset >= 100) {
                OI.progressHandler.updateBar("prog-bar", 100);
                return;
            }
            OI.progressHandler.updateBar("prog-bar", OI.progressHandler.getValue("prog-bar")
                + OI.progressHandler.charge_offset);
            setTimeout(OI.progressHandler.charge, 75);
        }
};

jQuery(document).ready(function () {
    OI.init();
});
</script>

<p id="app-loading-p">
<div class="progress progress-striped active">
  <div id="prog-bar" class="progress-bar"  role="progressbar" aria-valuenow="0" 
    aria-valuemin="0" aria-valuemax="100">
    <div id="progress-text">
        <span class="number-progress">0</span><span id="progress-static-text">% Complete</span>
    </div>
  </div>
</div>
</p>
